<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Grand Library Scene - Three.js</title>
  <style>body { margin: 0; overflow: hidden; }</style>
</head>
<body>
<script src="https://unpkg.com/three@0.153.0/build/three.min.js"></script>
<script>
// ---- Cena básica e camera ---------------
const scene = new THREE.Scene();
scene.background = new THREE.Color(0xdcc195);

const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
camera.position.set(0, 14, 38);
camera.lookAt(0, 6.8, -8);

// ---- Luz do sol dramática ---------------
const ambient = new THREE.AmbientLight(0xf1ead7, 0.25);
scene.add(ambient);
const keyLight = new THREE.DirectionalLight(0xffe5b9, 2.8);
keyLight.castShadow = true;
keyLight.position.set(-8,17,14);
keyLight.target.position.set(0,7,-16);
scene.add(keyLight);
scene.add(keyLight.target);

// ---- CHÃO e "rails"  --------------------
const chao = new THREE.Mesh(
  new THREE.BoxGeometry(16, 0.3, 38),
  new THREE.MeshLambertMaterial({ color: 0xb89261 }));
chao.position.set(0, -0.15, -8);
chao.receiveShadow = true;
scene.add(chao);
// Rails - 3 paralelos
for(let rx=-2; rx<=2; rx+=2){
  const trilho = new THREE.Mesh(
    new THREE.BoxGeometry(0.16,0.11,36),
    new THREE.MeshLambertMaterial({color:0xa56c31}));
  trilho.position.set(rx,0.02,-8);
  scene.add(trilho);
}

// ---- PAREDES DE PRATELEIRAS ALTAS -------
function criaParedaoEstante(x, profundidade, altura, nPrateleiras, fileiras, gapX=0.65) {
  // estrutura principal
  const estGeo = new THREE.BoxGeometry(1.15, altura, profundidade);
  const estMat = new THREE.MeshLambertMaterial({color:0x473424});
  const estrutura = new THREE.Mesh(estGeo, estMat);
  estrutura.position.set(x, altura/2, -8);
  estrutura.castShadow = true; estrutura.receiveShadow = true;
  scene.add(estrutura);
  // Prateleiras e Livros – linhas horizontais
  for(let p=0;p<nPrateleiras;p++){
    let py = 1.15 + p*((altura-2)/nPrateleiras);
    // Prateleira
    const prat = new THREE.Mesh(
      new THREE.BoxGeometry(1.19,0.09,profundidade-0.35),
      new THREE.MeshLambertMaterial({color:0x795224}));
    prat.position.set(x, py, -8);
    prat.castShadow = true;
    scene.add(prat);
    // Livros (pequenos cubos coloridos lado-a-lado)
    for(let f=0;f<fileiras;f++){
      const livroGeo = new THREE.BoxGeometry(gapX-0.09,0.45+0.10*Math.random(),0.17+0.11*Math.random());
      const livroMat = new THREE.MeshLambertMaterial({color:Math.floor(Math.random()*0xffffff)});
      const livro = new THREE.Mesh(livroGeo, livroMat);
      livro.position.set(x+0.07+(f-fileiras/2)*gapX, py+0.24, -16.8+0.42*Math.random());
      scene.add(livro);
    }
  }
}
criaParedaoEstante(-4.8,36,15.5,21,14,0.42);
criaParedaoEstante(4.8,36,15.5,21,14,0.42);

// ---- Parede/FDO prateleiras "catedral" + janelas altas ----
const paredeFundo = new THREE.Mesh(
  new THREE.BoxGeometry(8,15.5,0.8),
  new THREE.MeshLambertMaterial({color:0x9c8562})
);
paredeFundo.position.set(0,8,-26.6);
scene.add(paredeFundo);
// Prateleiras "coladas" à parede fundo
for(let p=0;p<22;p++){
  let py = 1.25 + p*0.62;
  for(let bx=-6;bx<=6;bx+=2){
    const livroGeo = new THREE.BoxGeometry(0.41,0.49+0.11*Math.random(),0.26);
    const livroMat = new THREE.MeshLambertMaterial({color:Math.floor(Math.random()*0xffffff)});
    const livro = new THREE.Mesh(livroGeo, livroMat);
    livro.position.set(bx*0.55,py,-26.09);
    scene.add(livro);
  }
}
// ---- JANELAS (fake stained glass) ---------
for(let jy=-2;jy<=2;jy++){
 let janela = new THREE.Mesh(
   new THREE.BoxGeometry(1.17,2.6,0.19),
   new THREE.MeshLambertMaterial({color:0xf4ecda,transparent:true,opacity:0.38})
 );
 janela.position.set(jy*1.45,12.7,-26.18);
 scene.add(janela);
}

// ---- Feixe solar semi-transparente --------
let feixe = new THREE.Mesh(
  new THREE.ConeGeometry(7,18,32,1,true),
  new THREE.MeshLambertMaterial({
    color:0xffeecc, transparent:true, opacity:0.11
  })
);
feixe.position.set(-3.7,16,-2);
feixe.rotation.x = Math.PI/2.6;
scene.add(feixe);

// ---- Personagem (sombra humana simples) ----
const player = new THREE.Mesh(
  new THREE.BoxGeometry(0.45,1.33,0.35),
  new THREE.MeshLambertMaterial({color:0x282828}));
player.position.set(0,0.66,4.2);
scene.add(player);

// ---- Render loop ----------------
function animate() {
  renderer.render(scene, camera);
  requestAnimationFrame(animate);
}
animate();

// Responsividade
window.addEventListener('resize', () => {
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>
</body>
</html>
