<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Biblioteca 3D Interativa - Three.js</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #info {
      position: absolute; top: 10px; left: 10px;
      background: rgba(255,255,255,0.85); padding: 10px 18px;
      border-radius: 8px; font-family: 'Segoe UI', sans-serif; font-size: 1.1rem;
      color: #0066bb; z-index: 4;
    }
  </style>
</head>
<body>
  <div id="info">
    Usa WASD para mover o boneco. Aproxima-te das prateleiras e pressiona "O" para ver info.
  </div>
  <script src="https://unpkg.com/three@0.153.0/build/three.min.js"></script>
  <script>
    // SETUP DA CENA
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xe2f1e9);

    const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 8, 18);

    const renderer = new THREE.WebGLRenderer({antialias: true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // ILUMINAÇÃO
    scene.add(new THREE.AmbientLight(0xffffff, 0.8));
    const dirLight = new THREE.DirectionalLight(0xffecb3, 0.8);
    dirLight.position.set(10,20,10);
    scene.add(dirLight);

    // CHÃO
    const floorGeo = new THREE.BoxGeometry(20, 0.5, 20);
    const floorMat = new THREE.MeshLambertMaterial({color:0xa1d6b6});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.position.y = -0.25;
    scene.add(floor);

    // PRATELEIRAS
    function criaPrateleira(x,z,label) {
      const shelfGeo = new THREE.BoxGeometry(2, 2, 0.5);
      const shelfMat = new THREE.MeshLambertMaterial({color:0xffc107});
      const shelf = new THREE.Mesh(shelfGeo, shelfMat);
      shelf.position.set(x, 1, z);
      shelf.userData.label = label;
      scene.add(shelf);
      return shelf;
    }
    const prateleiras = [
      criaPrateleira(-4, -5, "Licenciatura em Engenharia Biomédica<br>IPS/ISEL (2023- )<br>Projetos IA Médica, tese segmentação de tumores."),
      criaPrateleira(4, -5, "Ensino Secundário<br>Escola Secundária de Setúbal (2019-2022)<br>Distinção, competição natação."),
      criaPrateleira(0, -2, "Side Quests & Clubes<br>Clubes científicos, voluntariado, projetos extracurriculares.")
    ];

    // BONECO
    function criaBoneco() {
      const grupo = new THREE.Group();
      const corpoGeo = new THREE.BoxGeometry(1,1.6,0.7);
      const corpoMat = new THREE.MeshLambertMaterial({color:0x2196f3});
      const corpo = new THREE.Mesh(corpoGeo, corpoMat);
      corpo.position.y=1;
      grupo.add(corpo);
      const cabecaGeo = new THREE.BoxGeometry(0.8,0.7,0.7);
      const cabecaMat = new THREE.MeshLambertMaterial({color:0xfff176});
      const cabeca = new THREE.Mesh(cabecaGeo, cabecaMat);
      cabeca.position.y=2;
      grupo.add(cabeca);
      grupo.position.set(0,0.25,7);
      return grupo;
    }
    const boneco = criaBoneco();
    scene.add(boneco);

    // MOVIMENTO COM WASD
    const keys = {};
    document.addEventListener('keydown', e => keys[e.key.toLowerCase()] = true);
    document.addEventListener('keyup', e => keys[e.key.toLowerCase()] = false);

    let prateleiraPerto = null;

    function animate() {
      // Movimento
      if(keys["w"]) boneco.position.z -= 0.12;
      if(keys["s"]) boneco.position.z += 0.12;
      if(keys["a"]) boneco.position.x -= 0.12;
      if(keys["d"]) boneco.position.x += 0.12;

      // Limites do cenário
      boneco.position.x = Math.max(-9, Math.min(9, boneco.position.x));
      boneco.position.z = Math.max(-9, Math.min(9, boneco.position.z));

      // Câmera segue boneco
      camera.position.x = boneco.position.x;
      camera.position.z = boneco.position.z + 11;

      // Detectar proximidade (colisão simples)
      prateleiraPerto = null;
      for (const shelf of prateleiras) {
        const dist = Math.sqrt(
          Math.pow(boneco.position.x - shelf.position.x,2) +
          Math.pow(boneco.position.z - shelf.position.z,2)
        );
        if(dist < 2.2) {
          prateleiraPerto = shelf;
          break;
        }
      }

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    // Interação tecla "O"
    document.addEventListener('keydown', function(e){
      if(e.key.toLowerCase() === "o" && prateleiraPerto) {
        mostrarInfo(prateleiraPerto.userData.label);
      }
    });

    function mostrarInfo(texto){
      const div = document.getElementById('info');
      div.innerHTML = texto + '<br><span style="font-size:0.8em;color:#222;">(Mexe-te com WASD para explorar)</span>';
      setTimeout(()=>{div.innerHTML='Usa WASD para mover o boneco. Aproxima-te das prateleiras e pressiona "O" para ver info.'}, 3200);
    }
  </script>
</body>
</html>
