<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Biblioteca Clássica 3D - Three.js</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #info {
      position: absolute; top: 12px; left: 12px;
      background: rgba(255,255,255,0.92); padding: 10px 18px;
      border-radius: 8px; font-family: 'Segoe UI', sans-serif; font-size: 1.1rem;
      color: #0066bb; z-index: 4;
      box-shadow: 2px 3px 8px rgba(0,0,0,0.10);
    }
    #hud {
      position: fixed; left: 24px; bottom: 24px;
      background: rgba(240,247,255,0.95); padding: 13px 22px 11px 18px;
      border-radius: 14px; font-family: 'Segoe UI', Arial, sans-serif;
      color: #083c6a; min-width: 210px; font-size: 1.1rem; z-index: 10;
      border: 2px solid #a5c7e6; box-shadow: 2px 3px 8px rgba(0,0,0,0.08);
    }
    #hud .title { font-weight: bold; font-size: 1.05rem; margin-bottom: 8px; }
    #hud .keys { margin-top: 0; margin-bottom: 0; }
    #hud .key {
      background: #dbeafe;
      border-radius: 5px;
      padding: 3px 8px;
      margin: 0 4px;
      border: 1px solid #a5c7e6;
      font-weight: 500;
      display: inline-block;
      font-size: 1.0rem;
      color: #2a68b2;
    }
    #hud .desc { margin-top: 10px; font-size: 0.97rem; color: #1e3d59; }
  </style>
</head>
<body>
  <div id="info">Usa WASD para mover o boneco. Aproxima-te das prateleiras e pressiona <b>O</b> para ver info.</div>
  <div id="hud">
    <div class="title">Comandos:</div>
    <div class="keys">
      <span class="key">W</span> <span class="key">A</span> <span class="key">S</span> <span class="key">D</span>
      <span class="desc">Mover personagem</span>
    </div>
    <div class="keys" style="margin-top:7px;">
      <span class="key">O</span>
      <span class="desc">Abrir informação próxima</span>
    </div>
  </div>
  <script src="https://unpkg.com/three@0.153.0/build/three.min.js"></script>
  <script>
    // Cena
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xe8e3d1);

    // Câmera para uma perspetiva clássica central
    const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 8, 20);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Luz ambiente e direcional (simula luzes cálidas)
    scene.add(new THREE.AmbientLight(0xfad7a0, 0.7));
    const dirLight = new THREE.DirectionalLight(0xffe1b7, 0.85);
    dirLight.position.set(12,22,18);
    scene.add(dirLight);

    // Chão madeira escura arredondado (mesa central)
    const mesaGeo = new THREE.CylinderGeometry(7.5,7.5,1,32);
    const mesaMat = new THREE.MeshLambertMaterial({color: 0x8d5d35 });
    const mesa = new THREE.Mesh(mesaGeo, mesaMat);
    mesa.position.y = -0.55;
    mesa.userData.solido = true;
    scene.add(mesa);

    // Plataforma/chão de biblioteca
    const pisoGeo = new THREE.CylinderGeometry(10,10,0.45,40);
    const pisoMat = new THREE.MeshLambertMaterial({color: 0xc9ad7c });
    const piso = new THREE.Mesh(pisoGeo, pisoMat);
    piso.position.y = -1;
    piso.userData.solido = true;
    scene.add(piso);

    // Função para criar estantes clássicas
    function criaEstanteClassica(x, z, y=2.2, largura=0.8, altura=4.1, profundidade=8.1){
      const geo = new THREE.BoxGeometry(largura, altura, profundidade);
      const mat = new THREE.MeshLambertMaterial({color:0x7a4a21});
      const estante = new THREE.Mesh(geo, mat);
      estante.position.set(x, y, z);
      estante.userData.solido = true;
      scene.add(estante);

      // Livros decorativos (coloridos)
      for(let i=-3.5;i<=3.5;i+=1.4){
        const gbook = new THREE.BoxGeometry(0.2, Math.random()*2.9+0.7, 1);
        const mbook = new THREE.MeshLambertMaterial({color:Math.floor(Math.random()*0xffffff)});
        const book = new THREE.Mesh(gbook, mbook);
        book.position.set(x, y-1.3+Math.random()*2.3, z+i);
        scene.add(book);
      }
    }

    // Estantes nas paredes laterais e traseira
    criaEstanteClassica(-9, 0, 2.2); // esquerda
    criaEstanteClassica(9, 0, 2.2);  // direita
    criaEstanteClassica(0, -8.7, 2.2, 16, 4.1, 0.8); // traseira

    // Grades/painéis decorativos no andar superior
    function criaGrades(y=4.3, profundidade=8.1){
      for(let x=-8.7; x<=8.7; x+=1.2){
        const vGeo = new THREE.BoxGeometry(0.16, 1.1, 0.13);
        const vMat = new THREE.MeshLambertMaterial({color:0x403021});
        const vBar = new THREE.Mesh(vGeo, vMat);
        vBar.position.set(x, y, profundidade);
        scene.add(vBar);
      }
      const hGeo = new THREE.BoxGeometry(17.9, 0.14, 0.18);
      const hMat = new THREE.MeshLambertMaterial({color:0x403021});
      const hBar = new THREE.Mesh(hGeo, hMat);
      hBar.position.set(0, y+0.56, profundidade);
      scene.add(hBar);
    }
    criaGrades(4.6,8.1); // traseira
    criaGrades(4.6,-8.1); // frente
    // Grades nas laterais
    function criaGradesLaterais(y=4.6){
      for(let z=-8.1;z<=8.1;z+=1.3){
        const vGeo = new THREE.BoxGeometry(0.16, 1.1, 0.13);
        const vMat = new THREE.MeshLambertMaterial({color:0x403021});
        const vBar = new THREE.Mesh(vGeo, vMat);
        vBar.position.set(9, y, z);
        scene.add(vBar);
        const vBar2 = vBar.clone();
        vBar2.position.x = -9;
        scene.add(vBar2);
      }
      const hGeo = new THREE.BoxGeometry(0.12, 0.17, 16.5);
      const hMat = new THREE.MeshLambertMaterial({color:0x403021});
      const hBar = new THREE.Mesh(hGeo, hMat);
      hBar.position.set(9, y+0.5, 0);
      scene.add(hBar);
      const hBar2 = hBar.clone();
      hBar2.position.x = -9;
      scene.add(hBar2);
    }
    criaGradesLaterais();

    // Escada para acesso ao piso/deck superior
    function criaEscada(x, z, passos=8, hInicio=0.07){
      for(let i=0; i<passos; i++){
        const degrauGeo = new THREE.BoxGeometry(2.1, 0.14, 1.2);
        const degrauMat = new THREE.MeshLambertMaterial({color:0xe6cfa7});
        const degrau = new THREE.Mesh(degrauGeo, degrauMat);
        degrau.position.set(x, hInicio + i*0.33, z + i*0.9);
        degrau.userData.solido = true;
        scene.add(degrau);
      }
    }
    criaEscada(6,2,-1);

    // Prateleiras educativas/interativas
    function criaPrat(x, z, y=1.7, texto){
      const geo = new THREE.BoxGeometry(2.1, 2.1, 0.65);
      const mat = new THREE.MeshLambertMaterial({color:0xffc107});
      const shelf = new THREE.Mesh(geo, mat);
      shelf.position.set(x, y, z);
      shelf.userData.label = texto;
      shelf.userData.interacao = true;
      shelf.userData.solido = true;
      scene.add(shelf);
      return shelf;
    }
    const prateleiras = [
      criaPrat(-4.9, -5, 1.7, "Licenciatura em Engenharia Biomédica<br><i>IPS/ISEL (2023- )</i><br>Projetos IA Médica, tese segmentação de tumores."),
      criaPrat(4.9, -5, 1.7, "Ensino Secundário<br><i>Escola Secundária de Setúbal (2019-2022)</i><br>Distinção, competição natação."),
      criaPrat(0, -2, 1.7, "Side Quests & Clubes<br><i>Clubes científicos, voluntariado, projetos extracurriculares.</i>"),
      criaPrat(0, 6.9, 4.15, "Projetos científicos avançados<br><i>Explora o segundo piso da tua formação!</i>")
    ];

    // Boneco (avatar simples)
    function criaBoneco() {
      const grupo = new THREE.Group();
      const corpoGeo = new THREE.BoxGeometry(1, 1.6, 0.7);
      const corpoMat = new THREE.MeshLambertMaterial({color:0x2196f3});
      const corpo = new THREE.Mesh(corpoGeo, corpoMat);
      corpo.position.y = 1;
      grupo.add(corpo);
      const cabecaGeo = new THREE.BoxGeometry(0.8, 0.7, 0.7);
      const cabecaMat = new THREE.MeshLambertMaterial({color:0xfff176});
      const cabeca = new THREE.Mesh(cabecaGeo, cabecaMat);
      cabeca.position.y = 2;
      grupo.add(cabeca);
      grupo.position.set(0, 0.25, 7);
      return grupo;
    }
    const boneco = criaBoneco();
    scene.add(boneco);

    // Movimento WASD e colisões
    const keys = {};
    document.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
    document.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

    let prateleiraPerto = null;
    const speed = 0.13;

    const objetosSolidos = [];
    function atualizaColisoes() {
      objetosSolidos.length = 0;
      scene.traverse(obj => {
        if (obj.userData && obj.userData.solido) objetosSolidos.push(obj);
      });
    }
    atualizaColisoes();

    function colisao(nx, ny, nz) {
      for (const obj of objetosSolidos) {
        const ox = obj.position.x;
        const oy = obj.position.y;
        const oz = obj.position.z;
        const sx = obj.geometry.parameters.x || 1;
        const sy = obj.geometry.parameters.y || 1;
        const sz = obj.geometry.parameters.z || 1;

        if (
          nx > ox - sx / 2 &&
          nx < ox + sx / 2 &&
          ny > oy - sy / 2 &&
          ny < oy + sy / 2 &&
          nz > oz - sz / 2 &&
          nz < oz + sz / 2
        ) {
          return true;
        }
      }
      return false;
    }

    function animate() {
      let nx = boneco.position.x, ny = boneco.position.y, nz = boneco.position.z;

      if (keys["w"]) nz -= speed;
      if (keys["s"]) nz += speed;
      if (keys["a"]) nx -= speed;
      if (keys["d"]) nx += speed;

      if (keys["w"] || keys["s"]) {
        for (let alturaStep = 0.25; alturaStep <= 4.4; alturaStep += 0.33) {
          if (colisao(nx, alturaStep, nz)) {
            ny = alturaStep;
          }
        }
      }

      nx = Math.max(-8.8, Math.min(8.8, nx));
      nz = Math.max(-8, Math.min(8, nz));
      ny = Math.max(0.25, Math.min(4.2, ny));

      if (!colisao(nx, ny, nz)) {
        boneco.position.x = nx;
        boneco.position.z = nz;
        boneco.position.y = ny;
      }

      camera.position.x = boneco.position.x;
      camera.position.z = boneco.position.z + 12;
      camera.position.y = 6 + boneco.position.y / 1.7;

      prateleiraPerto = null;
      for (const shelf of prateleiras) {
        const dist = Math.sqrt(
          Math.pow(boneco.position.x - shelf.position.x, 2) +
          Math.pow(boneco.position.y - shelf.position.y, 2) +
          Math.pow(boneco.position.z - shelf.position.z, 2)
        );
        if (dist < 2.4) {
          prateleiraPerto = shelf;
          break;
        }
      }
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    document.addEventListener("keydown", function (e) {
      if (e.key.toLowerCase() === "o" && prateleiraPerto) {
        mostrarInfo(prateleiraPerto.userData.label);
      }
    });

    function mostrarInfo(texto) {
      const div = document.getElementById("info");
      div.innerHTML =
        texto +
        '<br><span style="font-size:0.8em;color:#222;">(Mexe-te com WASD para explorar e sobe as escadas!)</span>';
      setTimeout(() => {
        div.innerHTML = 'Usa WASD para mover o boneco. Aproxima-te das prateleiras e pressiona <b>O</b> para ver info.';
      }, 4200);
    }
  </script>
</body>
</html>
