<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Biblioteca 3D simples - Base Shelving</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #info { position: absolute; top: 12px; left: 12px;
      background: rgba(255,255,255,0.92); padding: 10px 18px;
      border-radius: 8px; font-family: 'Segoe UI', sans-serif;
      font-size: 1.1rem; color: #0066bb; z-index: 4; }
  </style>
</head>
<body>
  <div id="info">
    Usa WASD para mover o boneco. Aproxima-te das prateleiras e pressiona <b>O</b> para ver info.
  </div>
  <script src="https://unpkg.com/three@0.153.0/build/three.min.js"></script>
  <script>
    // Setup básico da cena:
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0xe8e3d1);

    const camera = new THREE.PerspectiveCamera(67, window.innerWidth/window.innerHeight, 0.1, 1000);
    camera.position.set(0, 11, 18);
    camera.lookAt(0, 4, 0);

    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);

    // Luz ambiente & direcional
    scene.add(new THREE.AmbientLight(0xf0dcbf, 0.7));
    const dirLight = new THREE.DirectionalLight(0xffe1b5, 1);
    dirLight.position.set(10, 20, 10);
    scene.add(dirLight);

    // Chão
    const floorGeo = new THREE.BoxGeometry(18, 0.3, 18);
    const floorMat = new THREE.MeshLambertMaterial({color: 0xc9ad7c});
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.position.y = -0.15;
    floor.userData.solido = true;
    scene.add(floor);

    // Cria estantes com prateleiras
    function criaEstante(x, z, largura, altura, profundidade) {
      const estGeo = new THREE.BoxGeometry(largura, altura, profundidade);
      const estMat = new THREE.MeshLambertMaterial({color: 0x7a4a21});
      const estante = new THREE.Mesh(estGeo, estMat);
      estante.position.set(x, altura/2, z);
      estante.userData.solido = true;
      scene.add(estante);

      // Adicionar livros cubo coloridos em filas horizontais (3 filas)
      const nFilas = 3;
      const livrosPorFila = Math.floor(largura / 0.7);

      for(let f=0; f<nFilas; f++) {
        const py = altura*0.18 + f*(altura*0.23);
        for(let l=0; l<livrosPorFila; l++) {
          const livroGeo = new THREE.BoxGeometry(0.55, 0.5, 0.2);
          const livroMat = new THREE.MeshLambertMaterial({color: Math.floor(Math.random()*0xffffff)});
          const livro = new THREE.Mesh(livroGeo, livroMat);
          const lx = x - largura/2 + (l + 0.5) * (largura/livrosPorFila);
          livro.position.set(lx, py, z + profundidade/2 + 0.12);
          scene.add(livro);
        }
      }
    }

    // Traseira e laterais
    criaEstante(0, -8.5, 16, 5, 0.7);
    criaEstante(-8.5, 0, 0.7, 5, 16);
    criaEstante(8.5, 0, 0.7, 5, 16);

    // Prateleiras interactives (blocos amarelos)
    function criaPrat(x, z, y, texto){
      const geo = new THREE.BoxGeometry(2.2, 2.2, 0.7);
      const mat = new THREE.MeshLambertMaterial({color: 0xffc107});
      const shelf = new THREE.Mesh(geo, mat);
      shelf.position.set(x, y, z);
      shelf.userData.label = texto;
      shelf.userData.interacao = true;
      shelf.userData.solido = true;
      scene.add(shelf);
      return shelf;
    }
    const prateleiras = [
      criaPrat(-5, -5, 1.7, "Licenciatura em Engenharia Biomédica<br><i>IPS/ISEL (2023- )</i><br>Projetos IA Médica, tese segmentação de tumores."),
      criaPrat(5, -5, 1.7, "Ensino Secundário<br><i>Escola Secundária de Setúbal (2019-2022)</i><br>Distinção, competição natação."),
      criaPrat(0, -2, 1.7, "Side Quests & Clubes<br><i>Clubes científicos, voluntariado, projetos extracurriculares.</i>")
    ];

    // Boneco simples
    function criaBoneco() {
      const grupo = new THREE.Group();
      const corpoGeo = new THREE.BoxGeometry(1, 1.6, 0.7);
      const corpoMat = new THREE.MeshLambertMaterial({color: 0x2196f3});
      const corpo = new THREE.Mesh(corpoGeo, corpoMat);
      corpo.position.y = 1;
      grupo.add(corpo);
      const cabecaGeo = new THREE.BoxGeometry(0.8, 0.7, 0.7);
      const cabecaMat = new THREE.MeshLambertMaterial({color: 0xfff176});
      const cabeca = new THREE.Mesh(cabecaGeo, cabecaMat);
      cabeca.position.y = 2;
      grupo.add(cabeca);
      grupo.position.set(0, 0.25, 5);
      return grupo;
    }
    let boneco = criaBoneco();
    scene.add(boneco);

    // Movimentação e colisões
    const keys = {};
    document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
    document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

    let prateleiraPerto = null;
    const speed = 0.13;
    const objetosSolidos = [];

    function atualizaColisoes() {
      objetosSolidos.length = 0;
      scene.traverse(obj => {
        if(obj.userData && obj.userData.solido)
          objetosSolidos.push(obj);
      });
    }
    atualizaColisoes();

    function colisao(nx, ny, nz) {
      for(const obj of objetosSolidos) {
        const ox = obj.position.x, oy = obj.position.y, oz = obj.position.z;
        const sx = obj.geometry.parameters.x || 1;
        const sy = obj.geometry.parameters.y || 1;
        const sz = obj.geometry.parameters.z || 1;
        if(
          nx > ox - sx/2 && nx < ox + sx/2 &&
          ny > oy - sy/2 && ny < oy + sy/2 &&
          nz > oz - sz/2 && nz < oz + sz/2
        ) return true;
      }
      return false;
    }

    function animate() {
      let nx = boneco.position.x, ny = boneco.position.y, nz = boneco.position.z;

      if(keys["w"]) nz -= speed;
      if(keys["s"]) nz += speed;
      if(keys["a"]) nx -= speed;
      if(keys["d"]) nx += speed;

      nx = Math.max(-7.5, Math.min(7.5, nx));
      nz = Math.max(-7.5, Math.min(7.5, nz));
      ny = Math.max(0.25, Math.min(4.2, ny));

      if(!colisao(nx, ny, nz)) {
        boneco.position.x = nx;
        boneco.position.z = nz;
        boneco.position.y = ny;
      }

      prateleiraPerto = null;
      for(const shelf of prateleiras) {
        const dist = Math.sqrt(
          Math.pow(boneco.position.x - shelf.position.x, 2) +
          Math.pow(boneco.position.y - shelf.position.y, 2) +
          Math.pow(boneco.position.z - shelf.position.z, 2)
        );
        if(dist < 2.4) {
          prateleiraPerto = shelf;
          break;
        }
      }
      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    document.addEventListener('keydown', function(e){
      if(e.key.toLowerCase() === 'o' && prateleiraPerto){
        mostrarInfo(prateleiraPerto.userData.label);
      }
    });
    function mostrarInfo(texto){
      const div = document.getElementById('info');
      div.innerHTML = texto + '<br><span style="font-size:0.8em;color:#222;">(Mexe-te com WASD para explorar!)</span>';
      setTimeout(() => {
        div.innerHTML = 'Usa WASD para mover o boneco. Aproxima-te das prateleiras e pressiona <b>O</b> para ver info.';
      }, 4200);
    }

    // Atualizar no resize
    window.addEventListener('resize', () => {
      renderer.setSize(window.innerWidth, window.innerHeight);
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
    });

  </script>
</body>
</html>
