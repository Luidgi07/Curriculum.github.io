<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <title>Jurassic Desktop Escola - Dois Sistemas 3D</title>
  <style>
    body {
      margin: 0;
      background: #004040;
      font-family: 'Courier New', Courier, monospace;
      color: #00ff00;
      cursor: url('https://img.icons8.com/fluency/48/old-mouse-cursor.png'), auto;
      overflow: hidden;
    }
    #fadeInPreVideo { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 6000; background: #000; opacity: 1; pointer-events: none; transition: opacity 1.5s; }
    #videoIntroContainer { position: fixed; z-index: 5000; left: 0; top: 0; width: 100vw; height: 100vh; background: #000; display: flex; align-items: center; justify-content: center; transition: opacity 1.6s; }
    #videoIntroContainer video { width: 100vw; height: 100vh; object-fit: cover; display: block; background: #000; }
    #introFade { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; z-index: 5100; background: #000; opacity: 0; pointer-events: none; transition: opacity 1.6s; }
    .desktop-icon { width: 95px; text-align: center; cursor: pointer; user-select: none; color: #00ff00; margin-bottom: 28px; position: absolute; left: 15px; }
    .desktop-icon img { width: 44px; height: 44px; filter: drop-shadow(0 0 4px #00ff00); margin-bottom: 3px; }
    #icon-school {top: 14px;}
    #icon-pc {top: 97px;}
    #icon-trash {top: 180px;}
    #icon-docs {top: 263px;}
    #icon-home { left: auto; right: 15px; top: 14px; }
    #desktop { width: 100vw; height: 100vh; position: relative; background: linear-gradient(135deg, #003333 25%, #006666 75%); overflow: hidden; }
    #programWindow {
      display: none;
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 540px;
      min-height: 370px;
      background: #002222;
      border: 2px solid #00ff00;
      padding: 18px 22px;
      box-sizing: border-box;
      z-index: 10;
      transition: opacity 0.3s;
    }
    #programWindow.closed { opacity: 0.3; pointer-events: none; }
    #programWindow header {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 15px;
      border-bottom: 1px solid #00ff00;
      padding-bottom: 8px;
      position: relative;
    }
    .closeProgramBtn {
      position: absolute;
      top: -2px;
      right: 8px;
      background: #004422;
      border: 1px solid #00ff00;
      color: #00ff00;
      font-size: 18px;
      cursor: pointer;
      padding: 0 12px;
      width: 30px;
      height: 28px;
      text-align: center;
      line-height: 28px;
      font-family: inherit;
    }
    .closeProgramBtn:hover { background: #005555; color: #fff; }
    #startButton {
      background: #004422;
      border: 1px solid #00ff00;
      color: #00ff00;
      font-size: 16px;
      padding: 8px 24px;
      cursor: pointer;
      margin: 28px auto 12px auto;
      display: block;
    }
    #infoBoxes {
      display: none;
      flex-wrap: wrap;
      gap: 13px;
      margin-bottom: 15px;
      justify-content: center;
    }
    .box {
      width: 140px;
      height: 70px;
      border: 2px solid #00ff00;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      background: linear-gradient(90deg, #003333 0%, #ffffff 100%);
      font-size: 16px;
      user-select: none;
      transition: background 0.2s;
      flex-shrink: 0;
      position: relative;
      flex-direction: column;
    }
    .box:hover { background: #005555; }
    .box img {
      width: 50%;
      display: block;
      margin: 0 auto 5px auto;
      pointer-events: none;
    }
    #infoContainer { margin-top: 12px; position: relative; }
    .download-bar {
      width: 96%;
      height: 20px;
      background: #001a00;
      border: 2px solid #00ff00;
      margin: 12px auto;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
    }
    .download-fill {
      background: #00ff00;
      height: 16px;
      width: 0;
      transition: width 1.5s linear;
    }
    .infoBoxWindow {
      background: #002222;
      border: 2px solid #00ff00;
      margin-top: 13px;
      padding: 12px;
      font-size: 15px;
      width: 95%;
      animation: windowAppear 0.23s linear;
      position: relative;
      z-index: 3;
    }
    @keyframes windowAppear {
      from { opacity: 0; transform: translateY(12px);}
      to { opacity: 1; transform: translateY(0); }
    }
    .modalOverlay, .confirmOverlay {
      position: fixed;
      left: 0; top: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,32,30,0.87);
      z-index: 2000;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .modalPage, .confirmBox {
      background: #002c26;
      border: 2px solid #00ff00;
      color: #00ff00;
      font-family: 'Courier New', Courier, monospace;
      min-width: 340px;
      min-height: 110px;
      padding: 27px 32px 20px 32px;
      font-size: 16px;
      box-shadow: 0 0 20px #003833;
      text-align: left;
      position: relative;
      animation: windowAppear 0.18s ease;
    }
    .closeBtn {
      position: absolute;
      right: 10px;
      top: 8px;
      background: #004422;
      color: #00ff00;
      border: 1px solid #00ff00;
      font-size: 15px;
      cursor: pointer;
      padding: 0 12px;
      font-family: inherit;
    }
    .closeBtn:hover { background: #005555; }
    .confirmBtn, .cancelBtn {
      background: #004422;
      border: 1px solid #00ff00;
      color: #00ff00;
      font-family: inherit;
      font-size: 15px;
      padding: 9px 30px;
      cursor: pointer;
      margin-top: 15px;
      margin-right: 15px;
      transition: background 0.22s;
    }
    .cancelBtn:hover, .confirmBtn:hover { background: #005555; }
    .loadingBar {
      width: 92%;
      height: 19px;
      background: #001a00;
      border: 2px solid #00ff00;
      margin: 29px auto 3px auto;
      position: relative;
      overflow: hidden;
      display: flex;
      align-items: center;
    }
    .loadingFill {
      background: #00ff00;
      height: 15px;
      width: 0;
      transition: width 1.3s linear;
    }
    #sysBar {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      height: 36px;
      background: #001f12;
      border-top: 2px solid #00ff00;
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 0 22px;
      color: #00ff00;
      font-family: inherit;
      font-size: 15px;
      z-index: 900;
    }
    .sysIcon {
      margin-right: 16px;
      vertical-align: middle;
      width: 21px;
      height: 21px;
      filter: drop-shadow(0 0 3px #00ff001c);
    }
    #sysBar span {
      margin-right: 23px;
      font-size: 13px;
    }
    body.three-active { overflow: hidden; background: #080c0e; }
    #threeContainer1, #threeContainer2 {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 1500;
      background: #080c0e;
      overflow: hidden;
      display: none;
    }
    #info1, #info2 {
      position: absolute; top: 18px; left: 18px;
      font-family: 'Courier New', monospace;
      background: rgba(5,40,15,0.92); color: #00ff00;
      padding: 13px 21px; border:2px solid #00ff00;
      border-radius: 8px; font-size: 18px; z-index: 1550;
      user-select: none;
    }
    #confirm1, #confirm2 {
      position: absolute; left:50%; top:51%;
      transform:translate(-50%, -50%);
      background:#002e0d; color:#00ff00;
      font-family:inherit;font-size:20px;z-index:1600;
      border:3px solid #00ff00; border-radius:14px;
      box-shadow: 0 0 33px #00ff005c;
      padding:35px 40px; display:none;
    }
    #conteudo1, #conteudo2 {
      position: absolute; left:50%; top:54%;
      transform:translate(-50%, -50%);
      background:#001c19;color:#00ff00;
      font-family:inherit;font-size:19px;z-index:1650;
      border:3px solid #00ff00;border-radius:13px;
      box-shadow:0 0 25px #00ff0033;padding:33px 40px;display:none;
    }
    #voltar-edu1, #voltar-edu2 {
      position: fixed;
      top: 26px;
      right: 26px;
      z-index: 1660;
      font-size: 18px;
      padding: 7px 19px;
      background: #11553d;
      color: #fff;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      box-shadow: 1px 2px 12px #00334ab7;
    }
  </style>
</head>
<body>
<div id="fadeInPreVideo"></div>
<div id="videoIntroContainer">
  <video id="introVideo" autoplay muted playsinline>
    <source src="Hailuo_Video_Num fundo preto profundo com u_419356922821341193.mp4" type="video/mp4">
  </video>
</div>
<div id="introFade"></div>

<div id="desktop">
  <div id="icon-school" class="desktop-icon" title="Abrir Escola">
    <img src="https://img.icons8.com/fluency/48/school-building.png" alt="Icone Escola" />
    <div>Escola</div>
  </div>
  <div id="icon-pc" class="desktop-icon" title="Este PC">
    <img src="https://img.icons8.com/fluency/48/monitor.png" alt="Icone Este PC" />
    <div>Este PC</div>
  </div>
  <div id="icon-trash" class="desktop-icon" title="Lixo">
    <img src="https://img.icons8.com/fluency/48/trash.png" alt="Icone Lixo" />
    <div>Lixo</div>
  </div>
  <div id="icon-docs" class="desktop-icon" title="Documentos">
    <img src="https://img.icons8.com/fluency/48/documents.png" alt="Icone Documentos" />
    <div>Documentos</div>
  </div>
  <div id="icon-home" class="desktop-icon" title="Página Inicial" style="right: 15px; left: auto; top: 14px;">
    <img src="https://img.icons8.com/fluency/48/home.png" alt="Ícone Casa" />
    <div>Início</div>
  </div>
  <div id="programWindow">
    <header>
      School Sistem
      <button class="closeProgramBtn" title="Fechar programa">X</button>
    </header>
    <button id="startButton">Iniciar programa</button>
    <div id="infoBoxes">
      <div class="box" data-info="Status: Ciências e Tecnologias." data-detail="SECUNDÁRIO: Escola Secundária de Santo André e Escola Secundária de Casquilhos" data-site="https://www.aed.edu.pt/"><img src="casquilhos.png" alt="Escola Secundária dos Casquilhos"></div>
      <div class="box" data-info="Status: Licenciatura em Tecnologia Biomédica." data-detail="IPS: 2022  - ..." data-site="https://www.ips.pt/"><img src="POLISET.png" alt="Politécnico de Setúbal"></div>
      <div class="box" data-info="Status: Unidades Curriculares Isoladas." data-detail="ISEL: 2025 - ... Sinais e Sistemas, Eletrónica e Instrumentação, Desenho Assistido por Computador, Processamento Digital de Sinais Biomédicos, Física Médica, Curso Preparatório de Matemática" data-site="https://www.isel.pt/"><img src="ISEL.png" alt="Instituto Superior de Engenharia de Lisboa"></div>
      <div class="box" data-info="Status: English A2." data-detail="TECMINHO: 2023." data-site="https://www.uminho.pt/"><img src="TECMINHO.png" alt="Universidade do Minho"></div>
      <div class="box" data-info="Status: Processamento e Análise de Dados com Python." data-detail="IPC: 2022." data-site="https://www.ipc.pt/"><img src="IPC.png" alt="Instituto Politécnico de Coimbra"></div>
    </div>
    <div id="infoContainer"></div>
  </div>
  <div id="sysBar">
    <img src="https://img.icons8.com/fluency/48/wifi.png" class="sysIcon" title="Wi-Fi" />
    <img src="https://img.icons8.com/fluency/48/high-volume.png" class="sysIcon" title="Volume" />
    <img src="https://img.icons8.com/fluency/48/empty-battery.png" class="sysIcon" title="Bateria" />
    <span id="sysHour"></span>
  </div>
</div>

<!-- Sistema 3D 1 -->
<div id="threeContainer1">
  <div id="info1">Scroll para zoom, arraste para girar. Passe o rato sobre os blocos e clique!</div>
  <div id="confirm1"></div>
  <div id="conteudo1"></div>
  <button id="voltar-edu1">Voltar atrás</button>
</div>

<!-- Sistema 3D 2 -->
<div id="threeContainer2">
  <div id="info2">Sistema 3D 2: Scroll para zoom, arraste para girar. Passe o rato sobre os blocos e clique!</div>
  <div id="confirm2"></div>
  <div id="conteudo2"></div>
  <button id="voltar-edu2">Voltar atrás</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
<script>
const preFade = document.getElementById('fadeInPreVideo');
window.onload = () => { setTimeout(() => { preFade.style.opacity = "0"; }, 180); };
const intro = document.getElementById('videoIntroContainer');
const fade = document.getElementById('introFade');
const desktop = document.getElementById('desktop');
const introVideo = document.getElementById('introVideo');
introVideo.onended = () => {
  fade.style.opacity = "1";
  setTimeout(() => {
    fade.style.opacity = "0";
    intro.style.display = "none";
    desktop.style.display = "block";
  }, 1500);
};
setTimeout(() => {
  if (intro.style.display !== "none") {
    fade.style.opacity = "1";
    setTimeout(() => {
      fade.style.opacity = "0";
      intro.style.display = "none";
      desktop.style.display = "block";
    }, 1500);
  }
}, 17000);
function updateHour() {
  const now = new Date();
  let hh = now.getHours().toString().padStart(2, '0');
  let mm = now.getMinutes().toString().padStart(2, '0');
  let ss = now.getSeconds().toString().padStart(2, '0');
  document.getElementById("sysHour").textContent = `${hh}:${mm}:${ss}`;
}
setInterval(updateHour, 950);
updateHour();

const schoolIcon = document.getElementById("icon-school");
const programWindow = document.getElementById("programWindow");
const startButton = document.getElementById("startButton");
const infoBoxes = document.getElementById("infoBoxes");
const infoContainer = document.getElementById("infoContainer");
const closeProgramBtn = document.querySelector('.closeProgramBtn');

schoolIcon.addEventListener("click", () => {
  programWindow.style.display = "block";
});

startButton.addEventListener("click", () => {
  infoBoxes.style.display = "flex";
  startButton.style.display = "none";
  infoContainer.innerHTML = "";
});

function manageDownloadWindows() {
  const activeDownloads = infoContainer.querySelectorAll('.infoBoxWindow');
  if (activeDownloads.length >= 4) {
    activeDownloads[0].previousSibling?.remove();
    activeDownloads[0].remove();
  }
}

infoBoxes.addEventListener("click", function(e) {
  // Permitir clique na div ou na imagem dentro da box
  let targetBox = null;
  if (e.target.classList.contains("box")) {
    targetBox = e.target;
  } else if (e.target.parentElement && e.target.parentElement.classList.contains("box")) {
    targetBox = e.target.parentElement;
  }
  if (targetBox) {
    manageDownloadWindows();
    const downloadBar = document.createElement("div");
    downloadBar.className = "download-bar";
    const fill = document.createElement("div");
    fill.className = "download-fill";
    downloadBar.appendChild(fill);
    const infoBoxWindow = document.createElement("div");
    infoBoxWindow.className = "infoBoxWindow";
    infoBoxWindow.textContent = "Carregando módulo...";
    infoContainer.appendChild(downloadBar);
    infoContainer.appendChild(infoBoxWindow);
    setTimeout(() => { fill.style.width = "100%"; }, 40);
    setTimeout(() => {
      infoBoxWindow.innerHTML = `<div>${targetBox.getAttribute("data-info")}</div>
      <div id="modalButtons"></div>`;
      downloadBar.remove();
      const modalBtnsDiv = infoBoxWindow.querySelector("#modalButtons");
      const titulo = targetBox.getAttribute("data-detail");
      const site = targetBox.getAttribute("data-site");
      const tituloUpper = titulo.toUpperCase();

      const isIPS = tituloUpper.includes('IPS');
      const isISEL = tituloUpper.includes('ISEL');

      // Botões lado a lado
      if (isIPS) {
        // Botão Documentos para sistema 3D 1
        const btnDocs1 = document.createElement("button");
        btnDocs1.textContent = "Documentos";
        btnDocs1.addEventListener("click", () => {
          desktop.style.display = "none";
          programWindow.style.display = "none";
          threeContainer1.style.display = "block";
          document.body.classList.add('three-active');
          if (!scene1) init3D1();
          closeModal();
        });
        modalBtnsDiv.appendChild(btnDocs1);
      } else if (isISEL) {
        // Botão Documentos para sistema 3D 2
        const btnDocs2 = document.createElement("button");
        btnDocs2.textContent = "Documentos";
        btnDocs2.addEventListener("click", () => {
          desktop.style.display = "none";
          programWindow.style.display = "none";
          threeContainer2.style.display = "block";
          document.body.classList.add('three-active');
          if (!scene2) init3D2();
          closeModal();
        });
        modalBtnsDiv.appendChild(btnDocs2);
      }

      // Botão Planos de Estudos para todos
      const btnPlanos = document.createElement("button");
      btnPlanos.textContent = "Planos de Estudos";
      btnPlanos.addEventListener("click", () => {
        if (site) {
          window.open(site, "_blank");
        } else {
          alert("Link para Planos de Estudos não disponível.");
        }
        closeModal();
      });
      modalBtnsDiv.appendChild(btnPlanos);
    }, 1510);
  }
});

function closeModal() {
  const overlay = document.querySelector('.modalOverlay');
  if (overlay) {
    document.body.removeChild(overlay);
  }
}

closeProgramBtn.addEventListener('click', function() {
  showConfirmBox();
});
function showConfirmBox() {
  const overlay = document.createElement("div");
  overlay.className = "confirmOverlay";
  const box = document.createElement("div");
  box.className = "confirmBox";
  box.innerHTML = `<div>Deseja mesmo fechar o programa?</div>
    <button class="confirmBtn">Sim</button>
    <button class="cancelBtn">Não</button>`;
  overlay.appendChild(box);
  document.body.appendChild(overlay);
  box.querySelector('.confirmBtn').onclick = function() {
    box.innerHTML = '<div>A fechar programa...</div>' +
      '<div class="loadingBar"><div class="loadingFill"></div></div>';
    const loadingFill = box.querySelector('.loadingFill');
    setTimeout(() => { loadingFill.style.width = "100%"; }, 30);
    setTimeout(() => {
      document.body.removeChild(overlay);
      programWindow.style.display = "none";
      infoBoxes.style.display = "none";
      startButton.style.display = "block";
      infoContainer.innerHTML = "";
    }, 1300);
  };
  box.querySelector('.cancelBtn').onclick = function() {
    document.body.removeChild(overlay);
  };
}

// SISTEMA 3D #1
const threeContainer1 = document.getElementById("threeContainer1");
const infoText1 = document.getElementById("info1");
const confirmBox1 = document.getElementById("confirm1");
const conteudoBox1 = document.getElementById("conteudo1");
const voltarEduBtn1 = document.getElementById("voltar-edu1");

let scene1, camera1, renderer1;
let camDist1 = 21, camRotX1 = 0.16, camRotY1 = -0.02;
let blocos1 = [], luzes1 = [];
const arquivos1 = [
  {nome:"Bioquímica", descricao:"Seminário de Fosfatidilserina", conteudo:"Conteúdo PDF: Bioquímica", link:"bioquimica.pdf"},
  {nome:"Sinais Vida", descricao:"Relatório Eletrotecnia", conteudo:"Conteúdo PDF: Sinais de Vida", link:"relatorio_eletrotecnia.pdf"},
  {nome:"Exoesqueleto", descricao:"Exoesqueleto Inferior", conteudo:"Conteúdo PDF: Exoesqueleto", link:"projeto_dpm_LTB.pdf"}
];

function init3D1() {
  if (scene1) return; // já inicializado
  scene1 = new THREE.Scene();
  camera1 = new THREE.PerspectiveCamera(57, window.innerWidth/window.innerHeight, 0.1, 160);
  setCameraPos1();

  renderer1 = new THREE.WebGLRenderer({antialias:true});
  renderer1.setSize(window.innerWidth, window.innerHeight);
  renderer1.setPixelRatio(window.devicePixelRatio);

  threeContainer1.innerHTML = '';
  threeContainer1.appendChild(infoText1);
  threeContainer1.appendChild(confirmBox1);
  threeContainer1.appendChild(conteudoBox1);
  threeContainer1.appendChild(voltarEduBtn1);
  threeContainer1.appendChild(renderer1.domElement);

  scene1.add(new THREE.AmbientLight(0x88ffbb, 0.63));
  let dirLight = new THREE.DirectionalLight(0xffffff, 0.80);
  dirLight.position.set(50,70,45);
  scene1.add(dirLight);

  const quadTam = 2.7, quadQtX = 10, quadQtZ = 5;
  for (let x=-quadQtX;x<=quadQtX;x++) {
    for (let z=-quadQtZ;z<=quadQtZ;z++) {
      let geo = new THREE.BoxGeometry(quadTam,0.14,quadTam);
      let mat = new THREE.MeshPhongMaterial({
        color:0x61ff7c, emissive:0x19ff36, emissiveIntensity:0.22, transparent:true, opacity:0.44
      });
      let quad = new THREE.Mesh(geo, mat);
      quad.position.set(x*quadTam,0, z*quadTam);
      scene1.add(quad);
    }
  }
  let baseGeo = new THREE.BoxGeometry(15*quadTam,0.48,6.4*quadTam);
  let baseMat = new THREE.MeshPhongMaterial({color:0xff3333, transparent:true, opacity:0.90});
  let base = new THREE.Mesh(baseGeo, baseMat);
  base.position.set(0, 0.17, 0);
  scene1.add(base);

  const nFileiras = 2;
  const blocosPorFileira = Math.ceil(arquivos1.length / nFileiras);
  const larguraBase = 15 * quadTam;
  const profundBase = 6.4 * quadTam;
  const espacoX = larguraBase / blocosPorFileira;
  const xInit = -larguraBase / 2 + espacoX / 2;
  const espacoZ = profundBase / (nFileiras + 1);
  const zInit = -profundBase / 2 + espacoZ;
  blocos1 = [];
  luzes1 = [];

  for (let i=0; i<arquivos1.length; i++) {
    let geometry = new THREE.BoxGeometry(2.6,0.75,1.7);
    let material = new THREE.MeshPhongMaterial({
      color:0x00ffbb, emissive:0x00ff00, emissiveIntensity:0.18
    });
    const linha = Math.floor(i / blocosPorFileira);
    let posNaLinha = i % blocosPorFileira;
    let bloco = new THREE.Mesh(geometry, material);
    bloco.position.set(
      xInit + posNaLinha * espacoX,
      0.82,
      zInit + linha * espacoZ
    );
    bloco.userData = arquivos1[i];
    scene1.add(bloco);
    blocos1.push(bloco);

    let canvas = document.createElement('canvas');
    canvas.width=130; canvas.height=37;
    let ctx = canvas.getContext('2d');
    ctx.font = 'bold 20px Courier';
    ctx.fillStyle = '#00ff00';
    ctx.fillText(arquivos1[i].nome,10,29);
    let tex = new THREE.CanvasTexture(canvas);
    let face = new THREE.Mesh(
      new THREE.PlaneGeometry(2.25,0.29),
      new THREE.MeshBasicMaterial({map:tex,transparent:true})
    );
    face.position.set(bloco.position.x, bloco.position.y+0.5, bloco.position.z);
    face.rotation.x = -0.54;
    scene1.add(face);

    let cylGeo = new THREE.CylinderGeometry(1.42,1.42,38,64,1,true);
    let cylMat = new THREE.MeshPhongMaterial({
      color:0xffffff, transparent:true, opacity:0.40, side:THREE.DoubleSide,
      emissive:0xffffff, emissiveIntensity:0.35
    });
    let spotlight = new THREE.Mesh(cylGeo, cylMat);
    spotlight.position.set(
      bloco.position.x,
      base.position.y + (baseGeo.parameters.height/2) + (38/2),
      bloco.position.z
    );
    spotlight.visible = false;
    scene1.add(spotlight);
    luzes1.push(spotlight);
  }

  let isDragging = false, prevX=0, prevY=0;
  threeContainer1.addEventListener("mousedown", e=>{
    isDragging=true; prevX=e.clientX; prevY=e.clientY;
  });
  window.addEventListener("mouseup", ()=> isDragging=false);
  window.addEventListener("mousemove", e=>{
    if(isDragging){
      camRotY1 += (e.clientX-prevX)*0.012;
      camRotX1 += (e.clientY-prevY)*0.006;
      camRotX1 = Math.max(0,Math.min(0.55, camRotX1));
      prevX = e.clientX; prevY = e.clientY;
      setCameraPos1();
    }
  });
  threeContainer1.addEventListener("wheel", e=>{
    e.preventDefault();
    camDist1 += e.deltaY<0 ? -2 : 2;
    camDist1 = Math.max(16,Math.min(34,camDist1));
    setCameraPos1();
  }, { passive:false });

  threeContainer1.addEventListener("mousemove", updateHoverHighlight1);
  threeContainer1.addEventListener("click", onClickBloco1);

  function setCameraPos1() {
    camera1.position.x = Math.sin(camRotY1) * Math.cos(camRotX1) * camDist1;
    camera1.position.y = Math.sin(camRotX1) * camDist1 + 3.2;
    camera1.position.z = Math.cos(camRotY1) * Math.cos(camRotX1) * camDist1;
    camera1.lookAt(0,0,0);
  }
  setCameraPos1();

  function updateHoverHighlight1(e) {
    const rect = renderer1.domElement.getBoundingClientRect();
    const mouse = {
      x: ((e.clientX - rect.left) / rect.width) * 2 - 1,
      y: -((e.clientY - rect.top) / rect.height) * 2 + 1
    };
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera1);
    const intersects = raycaster.intersectObjects(blocos1);
    let found = false;
    for (let i=0; i<blocos1.length; i++) {
      if (intersects.length > 0 && blocos1[i] === intersects[0].object) {
        luzes1[i].visible = true;
        found = true;
        infoText1.textContent = `Selecionado: ${blocos1[i].userData.nome}`;
      } else {
        luzes1[i].visible = false;
      }
    }
    if (!found) infoText1.textContent = "Scroll para zoom, arraste para girar. Passe o rato sobre os blocos e clique!";
  }

  function onClickBloco1(e) {
    const rect = renderer1.domElement.getBoundingClientRect();
    const mouse = {
      x: ((e.clientX - rect.left) / rect.width) * 2 - 1,
      y: -((e.clientY - rect.top) / rect.height) * 2 + 1
    };
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera1);
    const intersects = raycaster.intersectObjects(blocos1);

    confirmBox1.style.display = "none";
    conteudoBox1.style.display = "none";
    clearTimeout(window.delayPopup1);
    luzes1.forEach(luz => luz.visible = false);

    if (intersects.length > 0) {
      const i = blocos1.indexOf(intersects[0].object);
      if (i >= 0) {
        let luz = luzes1[i];
        luz.visible = true;
        luz.scale.set(1,0.18,1);
        let grow = () => {
          if(luz.scale.y < 1) {
            luz.scale.y += 0.11;
            requestAnimationFrame(grow);
          }
        };
        grow();
        infoText1.textContent = `Selecionado: ${blocos1[i].userData.nome}`;

        window.delayPopup1 = setTimeout(() => {
          confirmBox1.innerHTML =
            `<b>${blocos1[i].userData.nome}</b><br>
             <small>${blocos1[i].userData.descricao}</small><br>
             <div style="margin-top:13px;">Quero abrir esta pasta?</div>
             <button id="sim1">Sim</button>
             <button id="nao1">Não</button>`;
          confirmBox1.style.display = "block";

          document.getElementById("sim1").onclick = () => {
            confirmBox1.style.display = "none";
            luz.visible = false;
            if (blocos1[i].userData.link) {
              window.open(blocos1[i].userData.link, "_blank");
            } else {
              alert("PDF não encontrado para este documento.");
            }
          };

          document.getElementById("nao1").onclick = () => {
            confirmBox1.style.display = "none";
            luz.visible = false;
          };

          setTimeout(() => document.body.onclick = function(ev){
            if(!confirmBox1.contains(ev.target) && !conteudoBox1.contains(ev.target)){
              confirmBox1.style.display = "none";
              conteudoBox1.style.display = "none";
              luz.visible = false;
              document.body.onclick = null;
            }
          }, 120);
        }, 500);
      }
    }
  }

  function animate1() {
    requestAnimationFrame(animate1);
    renderer1.render(scene1, camera1);
  }
  animate1();

  window.addEventListener("resize", () => {
    if (!camera1 || !renderer1) return;
    camera1.aspect = window.innerWidth/window.innerHeight;
    camera1.updateProjectionMatrix();
    renderer1.setSize(window.innerWidth, window.innerHeight);
  });
}

// SISTEMA 3D #2
const threeContainer2 = document.getElementById("threeContainer2");
const infoText2 = document.getElementById("info2");
const confirmBox2 = document.getElementById("confirm2");
const conteudoBox2 = document.getElementById("conteudo2");
const voltarEduBtn2 = document.getElementById("voltar-edu2");

let scene2, camera2, renderer2;
let camDist2 = 21, camRotX2 = 0.16, camRotY2 = -0.02;
let blocos2 = [], luzes2 = [];
const arquivos2 = [
  {nome:"Genética", descricao:"Aula Genética", conteudo:"Conteúdo PDF: Genética", link:"DPM.pdf"},
  {nome:"Bombas Insulina", descricao:"Inovação em Insulina", conteudo:"Conteúdo PDF: Bombas Insulina", link:"Dispositivos_Médicos.pdf"},
  {nome:"Ressonância", descricao:"Projeto RM", conteudo:"Conteúdo PDF: Ressonância", link:"equipsaude.pdf"},
  {nome:"Nanopartículas", descricao:"Poster Nanopartículas", conteudo:"Conteúdo PDF: Nanopartículas", link:"Poster_1.pdf"},
  {nome:"CRISPR", descricao:"Poster CRISPR", conteudo:"Conteúdo PDF: CRISPR", link:"Poster_2.pdf"}
];

function init3D2() {
  if (scene2) return; // já inicializado
  scene2 = new THREE.Scene();
  camera2 = new THREE.PerspectiveCamera(57, window.innerWidth/window.innerHeight, 0.1, 160);
  setCameraPos2();

  renderer2 = new THREE.WebGLRenderer({antialias:true});
  renderer2.setSize(window.innerWidth, window.innerHeight);
  renderer2.setPixelRatio(window.devicePixelRatio);

  threeContainer2.innerHTML = '';
  threeContainer2.appendChild(infoText2);
  threeContainer2.appendChild(confirmBox2);
  threeContainer2.appendChild(conteudoBox2);
  threeContainer2.appendChild(voltarEduBtn2);
  threeContainer2.appendChild(renderer2.domElement);

  scene2.add(new THREE.AmbientLight(0x88ffbb, 0.63));
  let dirLight = new THREE.DirectionalLight(0xffffff, 0.80);
  dirLight.position.set(50,70,45);
  scene2.add(dirLight);

  const quadTam = 2.7, quadQtX = 12, quadQtZ = 7;
  for (let x=-quadQtX;x<=quadQtX;x++) {
    for (let z=-quadQtZ;z<=quadQtZ;z++) {
      let geo = new THREE.BoxGeometry(quadTam,0.14,quadTam);
      let mat = new THREE.MeshPhongMaterial({
        color:0x61ff7c, emissive:0x19ff36, emissiveIntensity:0.22, transparent:true, opacity:0.44
      });
      let quad = new THREE.Mesh(geo, mat);
      quad.position.set(x*quadTam,0, z*quadTam);
      scene2.add(quad);
    }
  }
  let baseGeo = new THREE.BoxGeometry(15*quadTam,0.48,6.4*quadTam);
  let baseMat = new THREE.MeshPhongMaterial({color:0xff3333, transparent:true, opacity:0.90});
  let base = new THREE.Mesh(baseGeo, baseMat);
  base.position.set(0, 0.17, 0);
  scene2.add(base);

  const nFileiras = 3;
  const blocosPorFileira = Math.ceil(arquivos2.length / nFileiras);
  const larguraBase = 15 * quadTam;
  const profundBase = 6.4 * quadTam;
  const espacoX = larguraBase / blocosPorFileira;
  const xInit = -larguraBase / 2 + espacoX / 2;
  const espacoZ = profundBase / (nFileiras + 1);
  const zInit = -profundBase / 2 + espacoZ;
  blocos2 = [];
  luzes2 = [];

  for (let i=0; i<arquivos2.length; i++) {
    let geometry = new THREE.BoxGeometry(2.6,0.75,1.7);
    let material = new THREE.MeshPhongMaterial({
      color:0x00ffbb, emissive:0x00ff00, emissiveIntensity:0.18
    });
    const linha = Math.floor(i / blocosPorFileira);
    let posNaLinha = i % blocosPorFileira;
    let bloco = new THREE.Mesh(geometry, material);
    bloco.position.set(
      xInit + posNaLinha * espacoX,
      0.82,
      zInit + linha * espacoZ
    );
    bloco.userData = arquivos2[i];
    scene2.add(bloco);
    blocos2.push(bloco);

    let canvas = document.createElement('canvas');
    canvas.width=130; canvas.height=37;
    let ctx = canvas.getContext('2d');
    ctx.font = 'bold 20px Courier';
    ctx.fillStyle = '#00ff00';
    ctx.fillText(arquivos2[i].nome,10,29);
    let tex = new THREE.CanvasTexture(canvas);
    let face = new THREE.Mesh(
      new THREE.PlaneGeometry(2.25,0.29),
      new THREE.MeshBasicMaterial({map:tex,transparent:true})
    );
    face.position.set(bloco.position.x, bloco.position.y+0.5, bloco.position.z);
    face.rotation.x = -0.54;
    scene2.add(face);

    let cylGeo = new THREE.CylinderGeometry(1.42,1.42,38,64,1,true);
    let cylMat = new THREE.MeshPhongMaterial({
      color:0xffffff, transparent:true, opacity:0.40, side:THREE.DoubleSide,
      emissive:0xffffff, emissiveIntensity:0.35
    });
    let spotlight = new THREE.Mesh(cylGeo, cylMat);
    spotlight.position.set(
      bloco.position.x,
      base.position.y + (baseGeo.parameters.height/2) + (38/2),
      bloco.position.z
    );
    spotlight.visible = false;
    scene2.add(spotlight);
    luzes2.push(spotlight);
  }

  let isDragging = false, prevX=0, prevY=0;
  threeContainer2.addEventListener("mousedown", e=>{
    isDragging=true; prevX=e.clientX; prevY=e.clientY;
  });
  window.addEventListener("mouseup", ()=> isDragging=false);
  window.addEventListener("mousemove", e=>{
    if(isDragging){
      camRotY2 += (e.clientX-prevX)*0.012;
      camRotX2 += (e.clientY-prevY)*0.006;
      camRotX2 = Math.max(0,Math.min(0.55, camRotX2));
      prevX = e.clientX; prevY = e.clientY;
      setCameraPos2();
    }
  });
  threeContainer2.addEventListener("wheel", e=>{
    e.preventDefault();
    camDist2 += e.deltaY<0 ? -2 : 2;
    camDist2 = Math.max(16,Math.min(34,camDist2));
    setCameraPos2();
  }, { passive:false });

  threeContainer2.addEventListener("mousemove", updateHoverHighlight2);
  threeContainer2.addEventListener("click", onClickBloco2);

  function setCameraPos2() {
    camera2.position.x = Math.sin(camRotY2) * Math.cos(camRotX2) * camDist2;
    camera2.position.y = Math.sin(camRotX2) * camDist2 + 3.2;
    camera2.position.z = Math.cos(camRotY2) * Math.cos(camRotX2) * camDist2;
    camera2.lookAt(0,0,0);
  }
  setCameraPos2();

  function updateHoverHighlight2(e) {
    const rect = renderer2.domElement.getBoundingClientRect();
    const mouse = {
      x: ((e.clientX - rect.left) / rect.width) * 2 - 1,
      y: -((e.clientY - rect.top) / rect.height) * 2 + 1
    };
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera2);
    const intersects = raycaster.intersectObjects(blocos2);
    let found = false;
    for (let i=0; i<blocos2.length; i++) {
      if (intersects.length > 0 && blocos2[i] === intersects[0].object) {
        luzes2[i].visible = true;
        found = true;
        infoText2.textContent = `Selecionado: ${blocos2[i].userData.nome}`;
      } else {
        luzes2[i].visible = false;
      }
    }
    if (!found) infoText2.textContent = "Scroll para zoom, arraste para girar. Passe o rato sobre os blocos e clique!";
  }

  function onClickBloco2(e) {
    const rect = renderer2.domElement.getBoundingClientRect();
    const mouse = {
      x: ((e.clientX - rect.left) / rect.width) * 2 - 1,
      y: -((e.clientY - rect.top) / rect.height) * 2 + 1
    };
    const raycaster = new THREE.Raycaster();
    raycaster.setFromCamera(mouse, camera2);
    const intersects = raycaster.intersectObjects(blocos2);

    confirmBox2.style.display = "none";
    conteudoBox2.style.display = "none";
    clearTimeout(window.delayPopup2);
    luzes2.forEach(luz => luz.visible = false);

    if (intersects.length > 0) {
      const i = blocos2.indexOf(intersects[0].object);
      if (i >= 0) {
        let luz = luzes2[i];
        luz.visible = true;
        luz.scale.set(1,0.18,1);
        let grow = () => {
          if(luz.scale.y < 1) {
            luz.scale.y += 0.11;
            requestAnimationFrame(grow);
          }
        };
        grow();
        infoText2.textContent = `Selecionado: ${blocos2[i].userData.nome}`;

        window.delayPopup2 = setTimeout(() => {
          confirmBox2.innerHTML =
            `<b>${blocos2[i].userData.nome}</b><br>
             <small>${blocos2[i].userData.descricao}</small><br>
             <div style="margin-top:13px;">Quero abrir esta pasta?</div>
             <button id="sim2">Sim</button>
             <button id="nao2">Não</button>`;
          confirmBox2.style.display = "block";

          document.getElementById("sim2").onclick = () => {
            confirmBox2.style.display = "none";
            luz.visible = false;
            if (blocos2[i].userData.link) {
              window.open(blocos2[i].userData.link, "_blank");
            } else {
              alert("PDF não encontrado para este documento.");
            }
          };

          document.getElementById("nao2").onclick = () => {
            confirmBox2.style.display = "none";
            luz.visible = false;
          };

          setTimeout(() => document.body.onclick = function(ev){
            if(!confirmBox2.contains(ev.target) && !conteudoBox2.contains(ev.target)){
              confirmBox2.style.display = "none";
              conteudoBox2.style.display = "none";
              luz.visible = false;
              document.body.onclick = null;
            }
          }, 120);
        }, 500);
      }
    }
  }

  function animate2() {
    requestAnimationFrame(animate2);
    renderer2.render(scene2, camera2);
  }
  animate2();

  window.addEventListener("resize", () => {
    if (!camera2 || !renderer2) return;
    camera2.aspect = window.innerWidth/window.innerHeight;
    camera2.updateProjectionMatrix();
    renderer2.setSize(window.innerWidth, window.innerHeight);
  });
}

// Botões voltar atrás para esconder os sistemas 3D e voltar ao desktop
voltarEduBtn1.addEventListener("click", () => {
  threeContainer1.style.display = "none";
  desktop.style.display = "block";
  programWindow.style.display = "block";
  document.body.classList.remove('three-active');
  confirmBox1.style.display = "none";
  conteudoBox1.style.display = "none";
});

voltarEduBtn2.addEventListener("click", () => {
  threeContainer2.style.display = "none";
  desktop.style.display = "block";
  programWindow.style.display = "block";
  document.body.classList.remove('three-active');
  confirmBox2.style.display = "none";
  conteudoBox2.style.display = "none";
});

document.getElementById("icon-home").addEventListener("click", function() {
  window.location.href = "index.html";
});
</script>
</body>
</html>
