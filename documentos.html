<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Portfólio Biomédica</title>
  <style>
    body { margin:0; background:#080c0e; overflow:hidden; }
    #info {
      position: absolute; top: 18px; left: 18px;
      font-family: 'Courier New', monospace;
      background: rgba(5,40,15,0.92); color: #00ff00;
      padding: 13px 21px; border:2px solid #00ff00;
      border-radius: 8px; font-size: 18px; z-index: 4;
    }
    #confirm {
      position: absolute; left:50%; top:51%;
      transform:translate(-50%, -50%);
      background:#002e0d; color:#00ff00;
      font-family:inherit;font-size:20px;z-index:100;
      border:3px solid #00ff00; border-radius:14px;
      box-shadow: 0 0 33px #00ff005c;
      padding:35px 40px; display:none;
    }
    #confirm button {
      background:#004422; border:2px solid #00ff00;
      color:#00ff00; font-family:inherit; font-size:18px;
      padding:9px 32px; cursor:pointer; border-radius:9px;
      margin:15px 16px 0 16px; transition:background 0.11s;
    }
    #confirm button:hover {background: #005555; color: #fff;}
    #conteudo {
      position: absolute; left:50%; top:54%;
      transform:translate(-50%, -50%);
      background:#001c19;color:#00ff00;
      font-family:inherit;font-size:19px;z-index:200;
      border:3px solid #00ff00;border-radius:13px;
      box-shadow:0 0 25px #00ff0033;padding:33px 40px;display:none;
    }
    #conteudo button {
      margin-top:18px;background:#004422; color:#00ff00;
      border:2px solid #00ff00;padding:7px 24px;font-size:18px;
      cursor:pointer;border-radius:9px;transition:background 0.11s;
    }
    #conteudo button:hover {background: #005555; color: #fff;}
    #voltar-edu {
      position: fixed;
      top: 26px;
      right: 26px;
      z-index: 104;
      font-size: 18px;
      padding: 7px 19px;
      background: #11553d;
      color: #fff;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      box-shadow: 1px 2px 12px #00334ab7;
    }
  </style>
</head>
<body>
<div id="info">Scroll para zoom, arraste para girar. Passe o rato sobre os blocos e clique!</div>
<div id="confirm"></div>
<div id="conteudo"></div>
<button id="voltar-edu">Voltar atrás</button>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/110/three.min.js"></script>
<script>
let scene = new THREE.Scene();
let camDist = 21, camRotX = 0.16, camRotY = -0.02;
let camera = new THREE.PerspectiveCamera(57, window.innerWidth/window.innerHeight, 0.1, 160);
function setCameraPos() {
  camera.position.x = Math.sin(camRotY) * Math.cos(camRotX) * camDist;
  camera.position.y = Math.sin(camRotX) * camDist + 3.2;
  camera.position.z = Math.cos(camRotY) * Math.cos(camRotX) * camDist;
  camera.lookAt(0,0,0);
}
setCameraPos();
let renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setPixelRatio(window.devicePixelRatio);
document.body.appendChild(renderer.domElement);
scene.add(new THREE.AmbientLight(0x88ffbb, 0.63));
let dirLight = new THREE.DirectionalLight(0xffffff, 0.80);
dirLight.position.set(50,70,45);
scene.add(dirLight);
// GRID GRANDE cobrindo todo o ecrã
let quadTam = 2.7, quadQtX = 28, quadQtZ = 18;
for (let x=-quadQtX;x<=quadQtX;x++) {
  for (let z=-quadQtZ;z<=quadQtZ;z++) {
    let geo = new THREE.BoxGeometry(quadTam,0.14,quadTam);
    let mat = new THREE.MeshPhongMaterial({
      color:0x61ff7c, emissive:0x19ff36,
      emissiveIntensity:0.22, transparent:true, opacity:0.44
    });
    let quad = new THREE.Mesh(geo, mat);
    quad.position.set(x*quadTam,0, z*quadTam);
    scene.add(quad);
  }
}
// BASE VERMELHA: retângulo sólido central
let baseGeo = new THREE.BoxGeometry(15*quadTam,0.48,6.4*quadTam);
let baseMat = new THREE.MeshPhongMaterial({color:0xff3333, transparent:true, opacity:0.90});
let base = new THREE.Mesh(baseGeo, baseMat);
base.position.set(0, 0.17, 0);
scene.add(base);
// Blocos: ficheiros estilo filme (preenche o meio das fileiras!)
let arquivos = [
  {nome:"Bioquímica",descricao:"Seminário de Fosfatidilserina",conteudo:"Conteúdo PDF: Bioquímica"},
  {nome:"Sinais Vida",descricao:"Relatório Eletrotecnia",conteudo:"Conteúdo PDF: Sinais de Vida"},
  {nome:"Exoesqueleto",descricao:"Exoesqueleto Inferior",conteudo:"Conteúdo PDF: Exoesqueleto"},
  {nome:"Bombas Insulina",descricao:"Inovação em Insulina",conteudo:"Conteúdo PDF: Bombas Insulina"},
  {nome:"Ressonância",descricao:"Projeto RM",conteudo:"Conteúdo PDF: Ressonância"},
  {nome:"Nanopartículas",descricao:"Poster Nanopartículas",conteudo:"Conteúdo PDF: Nanopartículas"},
  {nome:"CRISPR",descricao:"Poster CRISPR",conteudo:"Conteúdo PDF: CRISPR"},
  {nome:"Genética",descricao:"Aula Genética",conteudo:"Conteúdo PDF: Genética"},
  {nome:"Microbiologia",descricao:"Trabalho Microbiologia",conteudo:"Conteúdo PDF: Microbiologia"},
  {nome:"Fisiologia",descricao:"Resumo Fisiologia",conteudo:"Conteúdo PDF: Fisiologia"},
  {nome:"Histologia",descricao:"Resumo Histologia",conteudo:"Conteúdo PDF: Histologia"},
  {nome:"Farmacologia",descricao:"Resumo Farmacologia",conteudo:"Conteúdo PDF: Farmacologia"},
  {nome:"Bioética",descricao:"Ficha Bioética",conteudo:"Conteúdo PDF: Bioética"},
  {nome:"Epidemiologia",descricao:"Resumo Epidemiologia",conteudo:"Conteúdo PDF: Epidemiologia"},
  {nome:"Imunologia",descricao:"Poster Imunologia",conteudo:"Conteúdo PDF: Imunologia"},
  {nome:"Metabolismo",descricao:"Seminário Metabolismo",conteudo:"Conteúdo PDF: Metabolismo"},
  {nome:"Anatomia",descricao:"Resumo Anatomia",conteudo:"Conteúdo PDF: Anatomia"},
  {nome:"Endocrinologia",descricao:"Resumo Endocrinologia",conteudo:"Conteúdo PDF: Endocrinologia"}
];
let blocos=[], luzes=[];
const nFileiras = 3;
const blocosPorFileira = Math.ceil(arquivos.length / nFileiras);
const larguraBase = 15 * quadTam;
const profundBase = 6.4 * quadTam;
const espacoX = larguraBase / blocosPorFileira;
const xInit = -larguraBase / 2 + espacoX / 2;
const espacoZ = profundBase / (nFileiras + 1);
const zInit = -profundBase / 2 + espacoZ;
for (let i=0;i<arquivos.length;i++) {
  let geometry = new THREE.BoxGeometry(2.6,0.75,1.7);
  let material = new THREE.MeshPhongMaterial({
    color:0x00ffbb, emissive:0x00ff00,emissiveIntensity:0.18
  });
  const linha = Math.floor(i / blocosPorFileira);
  let posNaLinha = i % blocosPorFileira;
  let bloco = new THREE.Mesh(geometry, material);
  bloco.position.set(
    xInit + posNaLinha * espacoX,
    0.82,
    zInit + linha * espacoZ
  );
  bloco.userData = arquivos[i];
  scene.add(bloco);
  blocos.push(bloco);
  // Nome sobre bloco
  let canvas = document.createElement('canvas');
  canvas.width=130;canvas.height=37;
  let ctx = canvas.getContext('2d');
  ctx.font = 'bold 20px Courier';
  ctx.fillStyle = '#00ff00';
  ctx.fillText(arquivos[i].nome,10,29);
  let tex = new THREE.CanvasTexture(canvas);
  let face = new THREE.Mesh(
    new THREE.PlaneGeometry(2.25,0.29),
    new THREE.MeshBasicMaterial({map:tex,transparent:true})
  );
  face.position.set(bloco.position.x, bloco.position.y+0.5, bloco.position.z);
  face.rotation.x = -0.54;
  scene.add(face);
  // Luz: cilindro (hover highlight)
  let cylGeo = new THREE.CylinderGeometry(1.42,1.42,38,64,1,true);
  let cylMat = new THREE.MeshPhongMaterial({
    color:0xffffff, transparent:true, opacity:0.40, side:THREE.DoubleSide,
    emissive:0xffffff, emissiveIntensity:0.35
  });
  let spotlight = new THREE.Mesh(cylGeo, cylMat);
  spotlight.position.set(
    bloco.position.x,
    base.position.y + (baseGeo.parameters.height/2) + (38/2),
    bloco.position.z
  );
  spotlight.visible = false;
  scene.add(spotlight);
  luzes.push(spotlight);
}
let isDragging=false, prevX=0, prevY=0;
renderer.domElement.addEventListener("mousedown", e=>{
  isDragging=true; prevX=e.clientX;prevY=e.clientY;
});
window.addEventListener("mouseup",()=>isDragging=false);
window.addEventListener("mousemove",e=>{
  if(isDragging){
    camRotY += (e.clientX-prevX)*0.012;
    camRotX += (e.clientY-prevY)*0.006;
    camRotX = Math.max(-0.5,Math.min(0.55,camRotX));
    prevX = e.clientX; prevY = e.clientY;
    setCameraPos();
  }
});
renderer.domElement.addEventListener("wheel",e=>{
  e.preventDefault();
  camDist += e.deltaY<0 ? -2 : 2;
  camDist = Math.max(16,Math.min(34,camDist));
  setCameraPos();
});
function updateHoverHighlight(e) {
  const rect = renderer.domElement.getBoundingClientRect();
  const mouse = {
    x: ((e.clientX - rect.left) / rect.width) * 2 - 1,
    y: -((e.clientY - rect.top) / rect.height) * 2 + 1
  };
  const raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(blocos);
  let found = false;
  for (let i=0; i<blocos.length; i++) {
    if (intersects.length > 0 && blocos[i] === intersects[0].object) {
      luzes[i].visible = true;
      found = true;
      info.textContent = `Selecionado: ${blocos[i].userData.nome}`;
    } else {
      luzes[i].visible = false;
    }
  }
  if (!found) info.textContent = "Scroll para zoom, arraste para girar. Passe o rato sobre os blocos e clique!";
}
renderer.domElement.addEventListener("mousemove", updateHoverHighlight);
let info = document.getElementById("info");
let confirm = document.getElementById("confirm");
let conteudo = document.getElementById("conteudo");
let delayPopup;
renderer.domElement.addEventListener("click", function(e) {
  const rect = renderer.domElement.getBoundingClientRect();
  const mouse = {
    x: ((e.clientX - rect.left) / rect.width) * 2 - 1,
    y: -((e.clientY - rect.top) / rect.height) * 2 + 1
  };
  const raycaster = new THREE.Raycaster();
  raycaster.setFromCamera(mouse, camera);
  const intersects = raycaster.intersectObjects(blocos);
  confirm.style.display="none";
  conteudo.style.display="none";
  clearTimeout(delayPopup);
  luzes.forEach(luz=>luz.visible=false);
  if (intersects.length > 0) {
    const i = blocos.indexOf(intersects[0].object);
    if (i>=0) {
      let luz = luzes[i];
      luz.visible=true;
      luz.scale.set(1,0.18,1);
      let grow=()=>{if(luz.scale.y<1){luz.scale.y+=0.11;requestAnimationFrame(grow);}};
      grow();
      info.textContent = `Selecionado: ${blocos[i].userData.nome}`;
      delayPopup = setTimeout(function() {
        confirm.innerHTML =
          `<b>${blocos[i].userData.nome}</b><br>
           <small>${blocos[i].userData.descricao}</small><br>
           <div style="margin-top:13px;">Quero abrir esta pasta?</div>
           <button id="sim">Sim</button>
           <button id="nao">Não</button>`;
        confirm.style.display="block";
        document.getElementById("sim").onclick = ()=>{
          confirm.style.display = "none";
          conteudo.innerHTML = `<b>${blocos[i].userData.nome}</b><hr>
            <div>${blocos[i].userData.conteudo}</div>
            <button onclick="conteudo.style.display='none'">Fechar</button>`;
          conteudo.style.display = "block";
          luz.visible = false;
        };
        document.getElementById("nao").onclick = ()=>{
          confirm.style.display="none"; luz.visible=false;
        };
        setTimeout(()=>document.body.onclick=function(ev){
          if(!confirm.contains(ev.target) && !conteudo.contains(ev.target)){
            confirm.style.display="none";
            conteudo.style.display="none";
            luz.visible=false;
          }
        },120);
      },500);
    }
  }
});
window.addEventListener("resize",()=>{
  camera.aspect=window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
document.getElementById("voltar-edu").onclick = function() {
  window.location.href = "educacao.html";
};
function animate(){requestAnimationFrame(animate);renderer.render(scene,camera);}
animate();
</script>
</body>
</html>
